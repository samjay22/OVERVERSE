# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

OVERVERSE is a Roblox game project built with Luau, featuring a complex ability system with client-side prediction and server validation. The project uses Rojo for syncing between the filesystem and Roblox Studio.

## Development Commands

### Building and Syncing
```bash
# Start Rojo server to sync with Roblox Studio
rojo serve

# Build the project into a .rbxl file
rojo build -o OVERVERSE.rbxl
```

### Running in Roblox Studio
1. Install Rojo plugin in Roblox Studio
2. Run `rojo serve` in terminal
3. Connect via Rojo plugin in Studio
4. Use Studio's Run/Play buttons for testing

## Core Architecture

### Ability System
The ability system is the heart of the game, split between client prediction and server validation:

- **ClientAbilities** (`src/ReplicatedStorage/Modules/ClientAbilities/`): Each ability folder contains:
  - `Client.luau`: Client-side effects and prediction
  - `Server.luau`: Server validation and damage application
  - `Config.luau`: Ability parameters (damage, cooldowns, ammo)
  - `Shared.luau`: Shared validation logic
  - `Assets.rbxm`: Visual/audio assets

- **Ability Categories**:
  - **Primary**: Ammo-based abilities with reload mechanics (e.g., RemM1)
  - **Active/Secondary/Ultimate**: Cooldown-based abilities
  - **Passive**: Always-active effects

### Key Patterns

#### GetSharedModule Pattern
Every ability module implements `GetSharedModule()` to provide access to Config and Assets:
```lua
function Module.GetSharedModule()
    local sharedMod = require(script.Parent.Shared)
    sharedMod.GetAssets = function()
        return script.Parent.Assets
    end
    sharedMod.GetConfig = function()
        return require(script.Parent.Config)
    end
    return sharedMod
end
```

#### Resource Management
- **Ammo System**: Primary abilities use `MAX_AMMO`, `RELOAD_TIME`, `FIRE_RATE`
- **Cooldown System**: Other abilities use `COOLDOWN_TIME`
- Tracked client-side via `ClientAbilityTracker` with RunService.Heartbeat

#### Client-Server Communication
1. Client performs optimistic execution
2. Server validates via `OnRequest`
3. Client rolls back on rejection via `OnCancel`
4. Other clients see effects via `OnReplicate`

### File Organization

```
src/
├── ReplicatedStorage/       # Shared between client/server
│   └── Modules/
│       ├── ClientAbilities/ # Ability definitions
│       ├── Types/          # Type definitions
│       └── Utility/        # Shared utilities
├── ServerScriptService/    # Server-only scripts
│   └── Scripts/           # Server initialization
├── ServerStorage/         # Server-only modules
│   └── Modules/
│       ├── Entities/      # Character management
│       └── Services/      # Game services
├── StarterGui/           # UI components
│   └── AbilityDisplay/   # Ammo/cooldown UI
└── StarterPlayerScripts/ # Client scripts
```

## Common Development Tasks

### Adding a New Ability
1. Create folder in `src/ReplicatedStorage/Modules/ClientAbilities/AbilityName/`
2. Add required modules: Client.luau, Server.luau, Config.luau, Shared.luau
3. Set `ABILITY_CATEGORY` in Config to determine resource type
4. Implement `GetSharedModule()` in both Client and Server modules
5. Ability auto-tracked by ClientAbilityTracker if Config exists

### Testing Abilities
- Use DebugAbilityTracker in StarterPlayerScripts for console logging
- Check AbilityDisplay UI in game for ammo/cooldown status
- Server validation errors appear in server console

## Important Considerations

### Ability Loading
The ability loader (`ClientAbilities/init.luau`) dynamically injects `GetSharedModule` if missing or placeholder. Always check if existing implementation works before replacing.

### Performance
- Use RunService.Heartbeat for frame-accurate timing
- Client prediction reduces perceived latency
- Server validates all ability usage to prevent exploits

### Common Issues
- **"Should be injected" error**: GetSharedModule needs proper implementation
- **Config returns false**: Check GetSharedModule injection logic
- **Abilities not tracked**: Ensure Config module exists with ABILITY_CATEGORY

## Project Configuration

- **Rojo Project**: `default.project.json` - Maps filesystem to Roblox services
- **Toolchain**: `aftman.toml` / `rokit.toml` - Manages Rojo version
- **Source Map**: `sourcemap.json` - Generated by Rojo for debugging